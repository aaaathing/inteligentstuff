<button id="connect">Connect EV3</button>
<button id="beep">Beep</button>
<script>
let port, writer, reader;

async function connectEV3() {
  // 1) Ask the user to pick the EV3 serial port (secure context + user gesture required)
  port = await navigator.serial.requestPort();
  // 2) Open it â€” EV3 links commonly use 115200 8N1; adjust if needed
  await port.open({ baudRate: 115200 }); // try 57600 if your setup differs

  // optional: start a reader to see replies
  reader = port.readable.getReader();
  (async () => {
    const dec = new TextDecoder(); // EV3 replies are binary; decode/log for debugging
    while (true) {
      const { value, done } = await reader.read();
      if (done) break;
      console.log("EV3:", value);
    }
  })();

  writer = port.writable.getWriter();
  console.log("Connected.");
}

function sendDirectCommand(bytes) {
  // bytes: Uint8Array containing a full EV3 Direct Command frame
  return writer.write(bytes);
}

document.getElementById('connect').onclick = connectEV3;

// Example: a minimal "beep" Direct Command (UI SOUND TONE) frame.
// NOTE: Building correct EV3 frames means: [len lo, len hi, msg counter lo, msg counter hi,
// command type, global mem, local mem, ...opcodes/params...]. See the Comm Dev Kit.
document.getElementById('beep').onclick = async () => {
  // This is just a placeholder showing how you'd *send* a frame:
  // Replace 'frame' with a properly constructed command per LEGO docs.
  const frame = new Uint8Array([ /* ... fill with real bytes ... */ ]);
  await sendDirectCommand(frame);
};
</script>